(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{751:function(t,e,o){"use strict";o.r(e);o(5),o(4),o(2),o(1),o(6),o(3),o(7);var n=o(23),c=o(0),d=(o(57),o(12),o(16),o(37),o(8)),r=o(736),m=o(17),l=o(589),h=o.n(l);o(590),o(591);function f(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,o)}return e}d.default.use(new h.a({debug:!1,connection:"https://dev.apigochat.com/",options:{path:"/socket/socket.io",transports:["polling"],transportOptions:{polling:{extraHeaders:{Authorization:"Bearer ".concat(window.localStorage.getItem("auth")),Platform:"WebNop"}}}}}));var T={components:{Chat:r.default},sockets:{connect:function(){console.log("socket to notification channel connected")},disconnect:function(){console.log("socket diconnect !!!!!!")}},data:function(){return{syncTime:""}},computed:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(e){Object(c.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},Object(m.b)({sesssionid:function(t){return t.chat.session}})),mounted:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.getProfile){e.next=3;break}return e.next=3,t.getMe();case 3:d.default.use(new h.a({debug:!1,connection:"https://dev.apigochat.com/",options:{path:"/socket/socket.io",transports:["polling"],transportOptions:{polling:{extraHeaders:{Authorization:"Bearer ".concat(window.localStorage.getItem("auth")),Platform:"WebNop"}}}}})),t.getContact(),t.getRooms(),t.getOfficial(),t.sockets.subscribe("socketId",(function(data){this.syncTime=data.syncTime,this.$socket.emit("officials:user",'{"syncTime":"0001-01-01 00:00:00","page":1}'),this.$socket.emit("rooms",'{"syncTime":"'.concat(this.syncTime,'","page":1,"userId":"').concat(this.getProfile.id,'"}')),this.sockets.subscribe("rooms:".concat(this.getProfile.id),(function(data){var t=this;data.data.map((function(e){t.sockets.subscribe("messages:".concat(e.sessionId),(function(data){var t=this;data.data&&(this.addDataToRealm(data.data,"addMessage"),this.addDataToRealm(data.data,"updateShow"),this.addDataToRealm(this.getProfile,"updateUnreadcount"),this.addDataToRealm(this.getProfile,"updateLastmessage"),setTimeout((function(){t.setRooms()}),50))})),t.sockets.subscribe("messages:read:".concat(e.sessionId),(function(data){var t=this;this.addDataToRealm(data.data,"updateRead"),this.sesssionid==data.data.sessionId&&setTimeout((function(){t.setMessage(t.sesssionid)}),1e3)})),t.sockets.subscribe("messages:update:".concat(e.sessionId),(function(t){var o=this;t.data.map((function(data){o.sesssionid==data.sessionId&&o.$socket.emit("messages:read",'{"sessionId": "'.concat(data.sessionId,'","readTime":"').concat(data.messages[0].createdTime,'"}'))})),this.addDataToRealm(t.data,"updateDummyMesaage"),this.addDataToRealm(t.data,"addMessage"),this.addDataToRealm(t.data,"updateShow"),this.addDataToRealm(this.getProfile,"updateUnreadcount"),this.addDataToRealm(this.getProfile,"updateLastmessage"),setTimeout((function(){o.setRooms()}),50),this.sesssionid&&this.sesssionid==e.sessionId&&this.setMessage(this.sesssionid)}))})),data.data.map((function(e){t.$socket.emit("messages",'{"syncTime":"0001-01-01 00:00:00","sessionId":"'.concat(e.sessionId,'"}'))}))})),this.sockets.subscribe("officials:user:".concat(this.getProfile.id),(function(data){var t=this;data.data.map((function(e){console.log(e),t.$socket.emit("oa:auth",'{"userId":"'.concat(e.id,'"}')),t.sockets.subscribe("me:official:update:".concat(e.id),(function(data){var t=this,e=data.data[0];1==e.isBlock?(e.sessionId==this.sesssionid&&(this.$store.state.common.isblockroom=!0),this.addDataToRealm(e.id,"blockOfficial")):0==e.isBlock&&(e.sessionId==this.sesssionid&&(this.$store.state.common.isblockroom=!1),this.addDataToRealm(e.id,"unblockOfficial")),setTimeout((function(){t.setRooms()}),50)})),t.sockets.subscribe("rooms:official:update:".concat(e.id),(function(data){var t=this;data.data.map((function(o){o.roomtype="official",o.idofficialroom=e.id,t.checkDuplicateRoom(o.id)&&t.$socket.emit("join:room",'{"userId":"'.concat(e.id,'","sessionId":"').concat(o.sessionId,'"}'))})),this.checkDuplicateRoom(data.data[0].id)&&this.addDataToRealm(data.data,"addRooms"),this.sockets.subscribe("messages:".concat(data.data[0].sessionId),(function(data){this.addDataToRealm(data.data,"addMessage"),this.addDataToRealm(e,"updateUnreadcount"),this.addDataToRealm(e,"updateLastmessage")})),this.sockets.subscribe("messages:read:".concat(data.data[0].sessionId),(function(data){var t=this;this.addDataToRealm(data.data,"updateRead"),this.sesssionid==data.data.sessionId&&setTimeout((function(){t.setMessage(t.sesssionid)}),1e3)})),this.sockets.subscribe("messages:update:".concat(data.data[0].sessionId),(function(t){var e=this;t.data.map((function(data){e.sesssionid==data.sessionId&&e.$socket.emit("messages:read",'{"sessionId": "'.concat(data.sessionId,'","readTime":"').concat(data.messages[0].createdTime,'"}'))})),this.addDataToRealm(t.data,"updateDummyMesaage"),this.addDataToRealm(t.data,"addMessage"),this.addDataToRealm(this.getProfile,"updateUnreadcount"),this.addDataToRealm(this.getProfile,"updateLastmessage"),this.addDataToRealm(t.data,"updateShow"),setTimeout((function(){e.setRooms()}),50),this.sesssionid&&this.sesssionid==data.data[0].sessionId&&this.setMessage(this.sesssionid)})),this.$socket.emit("messages",'{"syncTime":"0001-01-01 00:00:00","sessionId":"'.concat(data.data[0].sessionId,'"}')),setTimeout((function(){t.setRooms()}),50)})),t.sockets.subscribe("rooms:".concat(e.id),(function(data){var t=this;console.log(data),data.data.map((function(t){return t.roomtype="official",t.idofficialroom=e.id})),data.data.length>0&&this.addDataToRealm(data.data,"addRooms"),this.sockets.subscribe("official:contacts:".concat(e.id),(function(data){var t=this;data.data.map((function(e){1==e.isBlock&&(t.addDataToRealm(e.id,"blockOfficial"),console.log(e.id))}))})),this.$socket.emit("official:contacts",'{"syncTime":"0001-01-01 00:00:00","page":1,"userId":"'.concat(e.id,'"}')),data.data.map((function(o){t.sockets.subscribe("messages:".concat(o.sessionId),(function(data){var t=this;this.addDataToRealm(data.data,"addMessage"),this.addDataToRealm(data.data,"updateShow"),this.addDataToRealm(e,"updateUnreadcount"),this.addDataToRealm(e,"updateLastmessage"),setTimeout((function(){t.setRooms()}),50)})),t.sockets.subscribe("messages:read:".concat(o.sessionId),(function(data){var t=this;this.addDataToRealm(data.data,"updateRead"),this.sesssionid==data.data.sessionId&&setTimeout((function(){t.setMessage(t.sesssionid)}),1e3)})),t.sockets.subscribe("messages:update:".concat(o.sessionId),(function(t){var e=this;t.data.map((function(data){e.sesssionid==data.sessionId&&e.$socket.emit("messages:read",'{"sessionId": "'.concat(data.sessionId,'","readTime":"').concat(data.messages[0].createdTime,'"}'))})),this.addDataToRealm(t.data,"updateDummyMesaage"),this.addDataToRealm(t.data,"addMessage"),this.addDataToRealm(this.getProfile,"updateUnreadcount"),this.addDataToRealm(this.getProfile,"updateLastmessage"),this.addDataToRealm(t.data,"updateShow"),setTimeout((function(){e.setRooms()}),50),this.sesssionid&&this.sesssionid==o.sessionId&&this.setMessage(this.sesssionid)})),t.$socket.emit("messages",'{"syncTime":"0001-01-01 00:00:00","sessionId":"'.concat(o.sessionId,'"}'))}))})),t.$socket.emit("rooms",'{"syncTime":"'.concat(t.syncTime,'","page":1,"userId":"').concat(e.id,'"}'))}))}))}));case 8:case"end":return e.stop()}}),e)})))()},methods:{checkDuplicateRoom:function(t){this.getdataDB.then((function(data){data.objects("ROOM").map((function(e){return e.id!=t}))}))},checkDuplicateMessage:function(t){this.getdataDB.then((function(data){data.objects("MESSAGE").map((function(t){console.log(t)}))}))},getMe:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$store.dispatch("auth/getMe");case 3:"success"===(o=e.sent).message&&t.$store.dispatch("auth/setProfile",o.data.userProfile),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},getContact:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o={dateTime:"2017-01-01 00:00:00",page:1,limit:10},e.next=4,t.$store.dispatch("contact/requestContactFrinds",o);case 4:200===(n=e.sent).status&&(t.addDataToRealm(n.data.data,"addUser"),t.setContact()),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},getRooms:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o={dateTime:"2017-01-01 00:00:00",page:1,limit:10},e.next=4,t.$store.dispatch("room/requestRoom",o);case 4:200===(n=e.sent).status&&(n.data.data.map((function(t){return t.roomtype="user"})),t.addDataToRealm(n.data.data,"addRooms")),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},getOfficial:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o={page:1,limit:20},e.next=4,t.$store.dispatch("official/requestOfficial",o);case 4:200===(n=e.sent).status&&(t.addDataToRealm(n.data.data,"addOfficial"),setTimeout((function(){t.setOfficial()}),500)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}}},R=T,k=o(11),component=Object(k.a)(R,(function(){var t=this.$createElement,e=this._self._c||t;return e("client-only",[e("Chat")],1)}),[],!1,null,null,null);e.default=component.exports}}]);