(window.webpackJsonp=window.webpackJsonp||[]).push([[145],{763:function(e,t,o){"use strict";o.r(t);o(5),o(4),o(2),o(1),o(6),o(3),o(7);var n=o(18),c=o(0),r=(o(47),o(13),o(10),o(19),o(12),o(37),o(748)),d=o(17),l=o(73);function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,o)}return t}var m=o(188).ipcRenderer,h={components:{Chat:r.default},data:function(){return{syncTime:"",token:this.$store.getters["auth/token"],Officialuser:null,Roomofficialdataupdate:[],Responseoaroom:[]}},computed:function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(c.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},Object(d.b)({sesssionid:function(e){return e.chat.session},profile:function(e){return e.auth.profile},userlogin:function(e){return e.auth.userlogin}})),created:function(){var e=this;this.getdataDB.then((function(t){var o=t.objects("LOGIN").filtered('userid == "'.concat(e.userlogin.id,'"'));console.log("login time"),o.map((function(t){e.syncTime=t.logoutstamptime}))})),this.getOfficial(),Object(l.b)()},mounted:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e.getProfile){t.next=3;break}return t.next=3,e.getMe();case 3:e.getContact(),l.a.on("keepAlive",(function(data){var t={synctime:data.syncTime,id:e.userlogin.id};e.addDataToRealm(t,"updateLogin")})),l.a.on("connect",(function(data){console.log("connect @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"),e.socketEvent()})),l.a.on("reconnect",(function(data){console.log("reconnect @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@")})),l.a.on("disconnect",function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(o){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(o.message),console.log("disconnect @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"),t.next=4,e.unsubSocketEvent();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),l.a.on("reconnecting",(function(){console.log("reconnecting @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@")})),l.a.on("reconnect_error",(function(e){console.log("reconnection error @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@")})),l.a.on("reconnect_failed",(function(){console.log("reconnection failed @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@")})),l.a.on("connect_error",(function(e){console.log("connect error@@@@@@@@@@@@@@@@@@@"),console.log("connect_error due to ".concat(e.message))}));case 12:case"end":return t.stop()}}),t)})))()},methods:{getTimeToUtc:function(){return(new Date).toISOString().substr(0,19).replace("T"," ")},unsubSocketEvent:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l.a.off("socketId"),l.a.off("web:auth:".concat(e.userlogin.id)),l.a.off("officials:user:".concat(e.userlogin.id)),e.Officialuser.map((function(e){l.a.off("me:official:update:".concat(e.id)),l.a.off("rooms:official:update:".concat(e.id)),l.a.off("official:contacts:".concat(e.id)),l.a.off("friends:update:".concat(e.id))})),e.Responseoaroom.map((function(data){data.map((function(e){l.a.off("messages:".concat(e.sessionId)),l.a.off("messages:update:".concat(e.sessionId)),l.a.off("messages:read:".concat(e.sessionId))}))})),e.Roomofficialdataupdate.length&&e.Roomofficialdataupdate.map((function(data){l.a.off("messages:".concat(data.sessionId)),l.a.off("messages:read:".concat(data.sessionId)),l.a.off("messages:update:".concat(data.sessionId))}));case 6:case"end":return t.stop()}}),t)})))()},socketEvent:function(){var e=this;l.a.on("socketId",(function(data){l.a.emit("web:auth",'{"userId": "'.concat(e.userlogin.id,'","auth":"Bearer ').concat(e.token,'"}')),l.a.on("web:auth:".concat(e.userlogin.id),(function(data){l.a.emit("officials:user",'{"auth":"Bearer '.concat(e.token,'","syncTime":"0001-01-01 00:00:00","page":1}')),l.a.on("officials:user:".concat(e.userlogin.id),(function(data){e.Officialuser=data.data,console.log("official user socket"),console.log(data.data),setTimeout((function(){e.setOfficial()}),1e3),data.data.map((function(t){l.a.emit("oa:auth",'{"auth":"Bearer '.concat(e.token,'","userId":"').concat(t.id,'"}')),l.a.on("me:official:update:".concat(t.id),(function(data){console.log("me official update"),console.log(data);var t=data.data[0];1==t.isBlock?(t.sessionId==e.sesssionid&&(e.$store.state.common.isblockroom=!0),e.addDataToRealm(t.id,"blockOfficial")):0==t.isBlock&&(t.sessionId==e.sesssionid&&(e.$store.state.common.isblockroom=!1),e.addDataToRealm(t.id,"unblockOfficial")),setTimeout((function(){e.setRooms()}),50)})),l.a.on("friends:update:".concat(t.id),(function(data){e.addDataToRealm(data.userProfile,"updateRoom"),e.addDataToRealm(data.userProfile,"updateMessageInRoom"),e.setRooms(),e.sesssionid&&e.setMessage(e.sesssionid)})),l.a.on("rooms:official:update:".concat(t.id),(function(data){console.log("room official update data"),console.log(data),e.Roomofficialdataupdate.push(data.data[0]),data.data[0].roomtype="official",data.data[0].idofficialroom=t.id,e.checkDuplicateRoom(data.data[0].id)&&l.a.emit("join:room",'{"auth":"Bearer '.concat(e.token,'","userId":"').concat(t.id,'","sessionId":"').concat(data.data[0].sessionId,'"}')),e.UpdateAddRoom(data.data),l.a.on("messages:".concat(data.data[0].sessionId),(function(data){console.log("message"),console.log(data),null!=data.data&&(e.addDataToRealm(data.data,"addMessage"),e.addDataToRealm(data.data,"updateShow"),e.addDataToRealm(e.getProfile,"updateUnreadcount"),e.addDataToRealm(e.getProfile,"updateLastmessage"))})),l.a.on("messages:read:".concat(data.data[0].sessionId),(function(data){e.addDataToRealm(data.data,"updateRead"),e.sesssionid==data.data.sessionId&&setTimeout((function(){e.setMessage(e.sesssionid)}),1e3)})),l.a.on("messages:update:".concat(data.data[0].sessionId),(function(t){console.log("message update"),console.log(e.profile),console.log(t),t.data.map((function(data){e.sesssionid==data.sessionId?l.a.emit("messages:read",'{"auth":"Bearer '.concat(e.token,'","sessionId": "').concat(data.sessionId,'","readTime":"').concat(data.messages[0].createdTime,'"}')):e.profile.adminuserids.map((function(t){t!=data.messages[0].senderId&&e.profile.id!=data.messages[0].senderId&&m.send("notify",data.messages[0])}))})),e.addDataToRealm(t.data,"updateDummyMesaage"),e.addDataToRealm(t.data,"addMessage"),e.addDataToRealm(e.getProfile,"updateUnreadcount"),e.addDataToRealm(e.getProfile,"updateLastmessage"),e.addDataToRealm(t.data,"updateShow"),setTimeout((function(){e.setRooms()}),50),e.sesssionid&&e.sesssionid==data.data[0].sessionId&&e.setMessage(e.sesssionid)})),l.a.emit("messages",'{"auth":"Bearer '.concat(e.token,'","syncTime":"').concat(e.syncTime,'","sessionId":"').concat(data.data[0].sessionId,'"}')),setTimeout((function(){e.setRooms()}),1e3)})),l.a.emit("join:all:rooms",'{"auth":"Bearer '.concat(e.token,'","userId":"').concat(t.id,'"}')),e.getOfficialRoom(t.id).then((function(o){e.Responseoaroom.push(o),console.log("oa room"),o.map((function(e){return e.roomtype="official",e.idofficialroom=t.id})),console.log(o),o.length>0&&e.Addroomofficial(o),l.a.on("official:contacts:".concat(t.id),(function(data){console.log("official contact"),console.log(data),data.data.map((function(t){1==t.isBlock&&e.addDataToRealm(t.id,"blockOfficial")}))})),l.a.emit("official:contacts",'{"auth":"Bearer '.concat(e.token,'","syncTime":"0001-01-01 00:00:00","page":1,"userId":"').concat(t.id,'"}')),o.map((function(o){l.a.on("messages:".concat(o.sessionId),(function(data){null!=data.data&&(e.addDataToRealm(data.data,"addMessage"),e.addDataToRealm(data.data,"updateShow"),e.checkDuplicateMessage(data.data)&&(e.addDataToRealm(t,"updateUnreadcount"),e.addDataToRealm(t,"updateLastmessage"))),setTimeout((function(){e.setRooms()}),50)})),l.a.on("messages:read:".concat(o.sessionId),(function(data){console.log("message read"),console.log(data),e.addDataToRealm(data.data,"updateRead"),e.sesssionid==data.data.sessionId&&setTimeout((function(){e.setMessage(e.sesssionid)}),1e3)})),l.a.on("messages:update:".concat(o.sessionId),(function(t){console.log("message update"),console.log(t),t.data.map((function(data){e.sesssionid==data.sessionId?(console.log("emitread"),l.a.emit("messages:read",'{"auth":"Bearer '.concat(e.token,'","sessionId": "').concat(data.sessionId,'","readTime":"').concat(data.messages[0].createdTime,'"}'))):(console.log("new message"),e.profile.adminuserids.map((function(t){t!=data.messages[0].senderId&&e.profile.id!=data.messages[0].senderId&&m.send("notify",data.messages[0])})))})),e.addDataToRealm(t.data,"updateDummyMesaage"),e.addDataToRealm(t.data,"addMessage"),e.addDataToRealm(e.getProfile,"updateUnreadcount"),e.addDataToRealm(e.getProfile,"updateLastmessage"),e.addDataToRealm(t.data,"updateShow"),setTimeout((function(){e.setRooms()}),50),e.sesssionid&&e.sesssionid==o.sessionId&&e.setMessage(e.sesssionid)})),l.a.emit("messages",'{"auth":"Bearer '.concat(e.token,'","syncTime":"').concat(e.syncTime,'","sessionId":"').concat(o.sessionId,'"}'))}))}))}))}))}))}))},checkDuplicateRoom:function(e){this.getdataDB.then((function(data){return 0==data.objects("ROOM").filtered('id == "'.concat(e,'"')).length}))},UpdateAddRoom:function(e){var t=this;console.log("function api room"),console.log(e),this.getdataDB.then((function(data){var o=data.objects("ROOM").filtered('id == "'.concat(e[0].id,'"'));console.log("room length"),console.log(o.length),0==o.length&&t.addDataToRealm(e,"addRooms")}))},Addroomofficial:function(e){var t=this;console.log("Add Official room"),this.getdataDB.then((function(data){e.map((function(e){0==data.objects("ROOM").filtered('id == "'.concat(e.id,'"')).length&&t.addDataToRealm(e,"addOfficialRooms")}))}))},checkDuplicateMessage:function(e){this.getdataDB.then((function(data){e.map((function(e){e.messages.map((function(e){return!(data.objects("MESSAGE").filtered('messageid == "'.concat(e.messageId,'" ')).length>0)}))}))}))},getMe:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$store.dispatch("auth/getMe");case 3:"success"===(o=t.sent).message&&e.$store.dispatch("auth/setProfile",o.data.userProfile),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},getContact:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o={dateTime:"2017-01-01 00:00:00",page:1,limit:10},t.next=4,e.$store.dispatch("contact/requestContactFrinds",o);case 4:200===(n=t.sent).status&&(e.addDataToRealm(n.data.data,"addUser"),e.setContact()),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},getRooms:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o={dateTime:"2017-01-01 00:00:00",page:1,limit:10},t.next=4,e.$store.dispatch("room/requestRoom",o);case 4:200===(n=t.sent).status&&(n.data.data.map((function(e){return e.roomtype="user"})),e.addDataToRealm(n.data.data,"addRooms")),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},getOfficial:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o={page:1,limit:20},t.next=4,e.$store.dispatch("official/requestOfficial",o);case 4:200===(n=t.sent).status&&(n.data.data.map((function(t){console.log("profile id"),console.log(e.profile.id),t.profileId=e.profile.id})),e.addDataToRealm(n.data.data,"addOfficial")),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},getOfficialRoom:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var n,c;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,n={page:1,limit:100,userId:e,dateTime:"0001-01-01 00:00:00"},o.next=4,t.$store.dispatch("official/requestOfficialRoom",n);case 4:return c=o.sent,o.abrupt("return",c.data.data);case 8:return o.prev=8,o.t0=o.catch(0),o.abrupt("return",o.t0);case 11:case"end":return o.stop()}}),o,null,[[0,8]])})))()}}},R=h,T=o(11),component=Object(T.a)(R,(function(){var e=this.$createElement,t=this._self._c||e;return t("client-only",[t("Chat")],1)}),[],!1,null,null,null);t.default=component.exports}}]);